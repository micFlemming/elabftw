{% extends 'base.html' %}

{% block body %}
<!-- display current and latest version -->
<p>{{ 'Installed version:'|trans }} <span id='currentVersion'>{{ v }}</span>
<br>
{{ 'Latest version:'|trans }} <span id='latestVersion'></span>

<!-- show error if the email is not configured -->
{% if App.Config.configArr.mail_from == 'notconfigured@example.com' %}
    {{ 'Please finalize install: %slink to documentation%s.'|trans|format("<a href='https://doc.elabftw.net/sysadmin-guide.html#setting-up-email'>", "</a>")|msg('ko') }}
{% endif %}

<p>Docker image version: {{ elabimgVersion }}<br />
MySQL database structure version: {{ App.Config.configArr.schema }}</p>

<div id='versionNotifZone'></div>

<ul class='tabbed-menu'>
  <li data-action='switch-tab' data-tabtarget='1'>{{ 'Server'|trans }}</li>
  <li data-action='switch-tab' data-tabtarget='2'>{{ 'Teams'|trans }}</li>
  <li data-action='switch-tab' data-tabtarget='3'>{{ 'Users'|trans }}</li>
  <li data-action='switch-tab' data-tabtarget='4'>{{ 'Timestamp'|trans }}</li>
  <li data-action='switch-tab' data-tabtarget='5'>{{ 'Security'|trans }}</li>
  <li data-action='switch-tab' data-tabtarget='6'>{{ 'Email'|trans }}</li>
  <li data-action='switch-tab' data-tabtarget='7'>SAML</li>
  <li data-action='switch-tab' data-tabtarget='8'>{{ 'Privacy policy'|trans }}</li>
  <li data-action='switch-tab' data-tabtarget='9'>{{ 'External auth'|trans }}</li>
  <li data-action='switch-tab' data-tabtarget='10'>LDAP</li><span class='beta'>beta</span>
  <li data-action='switch-tab' data-tabtarget='11'>{{ 'Uploads'|trans }}</li>
</ul>

<!-- loading spinner -->
<div class='d-flex justify-content-center' id='loading-spinner'>
  <div class='lds-dual-ring'></div>
</div>

<!-- TAB 1 SERVER -->
<div data-tabcontent='1' hidden>
    <!-- STATS -->
    <div class='box'>
      <h3>{{ 'Usage Statistics'|trans }}</h3>
      <hr>
      <p>{{ 'Teams'|trans }}: {{ teamsStats.totteams }} - {{ 'Members'|trans }}: {{ teamsStats.totusers }} − {% trans %}Experiment{% plural teamStats.totxp %}Experiments{% endtrans %}: {{ teamsStats.totxp }} ({{ teamsStats.totxpts }} timestamped) − {{ 'Items'|trans }}: {{ teamsStats.totdb }}</p>
      <hr>
      <a href='make.php?what=report' class='button btn btn-primary'>{{ 'Generate report'|trans }}</a>
    </div>

    <div class='box'>
      <h3>{{ 'Announcement'|trans }}</h3>
      <hr>
      <p>{{ "The following text will be displayed to all users on all pages while it's active."|trans }}</p>
      <form method='post' action='app/controllers/SysconfigController.php'>
        {{ App.Session.get('csrf')|csrf }}
        <input class='form-control' type='text' name='announcement' value='{{ App.Config.configArr.announcement }}' />
        <div class='mt-4 text-center'>
          <button type='submit' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
          <button type='submit' name='clear_announcement' class='button btn btn-danger'>{{ 'Clear'|trans }}</button>
        </div>
      </form>
    </div>

    <div class='box'>
      <h3>{{ 'Login page announcement'|trans }}</h3>
      <hr>
      <p>{{ 'The following text will be displayed only on the login page.'|trans }}</p>
      <form method='post' action='app/controllers/SysconfigController.php'>
        {{ App.Session.get('csrf')|csrf }}
        <input class='form-control' type='text' name='login_announcement' value='{{ App.Config.configArr.login_announcement }}' />
        <div class='mt-4 text-center'>
          <button type='submit' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
          <button type='submit' name='clear_login_announcement' class='button btn btn-danger'>{{ 'Clear'|trans }}</button>
        </div>
      </form>
    </div>

    <form class='box' method='post' action='app/controllers/SysconfigController.php'>
        {{ App.Session.get('csrf')|csrf }}
        <h3>{{ 'Settings'|trans }}</h3>
        <hr>
        <div class='form-group'>
          <input type='hidden' name='updateConfig' value='true' />
          <label for='lang'>{{ 'Language:'|trans }}</label>
          <select id='lang' name='lang' class='form-control col-md-4' autocomplete='off'>
              {% for lang, text in langsArr %}
              <option {{ App.Config.configArr.lang == lang ? ' selected' }} value='{{ lang }}'>{{ text }}</option>
              {% endfor %}
          </select>
          <p class='smallgray'>{{ 'The default language of this instance. It can be overridden by each users.' }}</p>

          <label for='proxy'>{{ 'Address of the Proxy:'|trans }}</label>
          <input class='form-control col-md-4' type='text' value='{{ App.Config.configArr.proxy }}' name='proxy' id='proxy' />
          <p class='smallgray'>{{ 'If you are behind a firewall/proxy, enter the address here. Example: http://proxy.example.com:3128'|trans }}</p>

          <label for='deletable_xp'>{{ 'Admins can always delete experiments:'|trans }}</label>
          <select id='deletable_xp' name='deletable_xp' class='form-control col-md-4' autocomplete='off'>
              <option {{ App.Config.configArr.deletable_xp == 1 ? ' selected' }} value='1'>{{ 'Yes'|trans }}</option>
              <option {{ App.Config.configArr.deletable_xp == 0 ? ' selected' }} value='0'>{{ 'No'|trans }}</option>
          </select>
          <p class='smallgray'>{{ 'Setting this to «no» will completely remove the ability to delete experiments for everyone.'|trans }}</p>

          <label for='max_revisions'>{{ 'Maximum number of stored revisions per entry:'|trans }}</label>
          <input class='form-control col-md-4' type='number' min='0' max='999' value='{{ App.Config.configArr.max_revisions }}' name='max_revisions' id='max_revisions' />
          <p class='smallgray'>{{ 'Setting this to a low value will help keeping the database size small. Setting this to 0 will allow infinite number of revisions stored.'|trans }}</p>

          <label for='min_delta_revisions'>{{ 'Minimum number of characters that need to be changed in order to create a new revision per entry:'|trans }}</label>
          <input class='form-control col-md-4' type='number' min='1' max='999' value='{{ App.Config.configArr.min_delta_revisions }}' name='min_delta_revisions' id='min_delta_revisions' />
          <p class='smallgray'>{{ 'Setting this to a high value will help keeping the database size small.'|trans }}</p>

          <label for='min_days_revisions'>{{ 'Number of days between changes to automatically create a revision:'|trans }}</label>
          <input class='form-control col-md-4' type='number' min='1' max='999' value='{{ App.Config.configArr.min_days_revisions }}' name='min_days_revisions' id='min_days_revisions' />
          <p class='smallgray'>{{ 'If the last change is at least this days old, a revision will be created regardless of the minimum characters setting.'|trans }}</p>

          <h3>{{ 'Registration and authentication configuration'|trans }}</h3>

          <label for='anon_users'>{{ 'Allow anonymous visitors to login and see Public experiments:'|trans }}</label>
          <select class='form-control col-md-4' name='anon_users' id='anon_users'>
              <option value='1'{{ App.Config.configArr.anon_users ? " selected='selected'" }}>{{ 'Yes'|trans }}</option>
              <option value='0'{{ not App.Config.configArr.anon_users ? " selected='selected'" }}>{{ 'No'|trans }}</option>
          </select>
          <p class='smallgray'>{{ 'This allows users without an account to login into a team and see the experiments with public visibility. Administrators of each team can choose whether or not database items will be visible.'|trans }}</p>

          <label for='open_science'>{{ 'Switch this instance in open science mode:'|trans }}</label>
          <select id='open_science' name='open_science' class='form-control col-md-4'>
              <option {{ App.Config.configArr.open_science == '1' ? ' selected' }} value='1'>{{ 'Yes'|trans }}</option>
              <option {{ App.Config.configArr.open_science == '0' ? ' selected' }} value='0'>{{ 'No'|trans }}</option>
          </select>
          <p class='smallgray'>{{ 'This allows search engines to crawl the site. Visitors will be automatically logged in in the specified team.'|trans }}</p>

          <label for='open_team'>{{ 'Select which team will be open to the world in open science mode:'|trans }}</label>
          <select id='open_team' name='open_team' class='form-control col-md-4'>
              {% for team in teamsArr %}
              <option {{ App.Config.configArr.open_team == team.id ? ' selected' }} value='{{ team.id }}'>{{ team.name }}</option>
              {% endfor %}
          </select>
          <p class='smallgray'>{{ 'This has no effect if open science mode is disabled.'|trans }}</p>

          <label for='local_register'>{{ 'Enable local account creation:'|trans }}</label>
          <select id='local_register' name='local_register' class='form-control col-md-4'>
              <option {{ App.Config.configArr.local_register == '1' ? ' selected' }} value='1'>{{ 'Yes'|trans }}</option>
              <option {{ App.Config.configArr.local_register == '0' ? ' selected' }} value='0'>{{ 'No'|trans }}</option>
          </select>

          <label for='admins_create_users'>{{ 'Admins can create local accounts:'|trans }}</label>
          <select id='admins_create_users' name='admins_create_users' class='form-control col-md-4'>
              <option {{ App.Config.configArr.admins_create_users == '1' ? ' selected' }} value='1'>{{ 'Yes'|trans }}</option>
              <option {{ App.Config.configArr.admins_create_users == '0' ? ' selected' }} value='0'>{{ 'No'|trans }}</option>
          </select>

          <label for='local_login'>{{ 'Show local login form:'|trans }}</label>
          <select id='local_login' name='local_login' class='form-control col-md-4'>
              <option {{ App.Config.configArr.local_login == '1' ? ' selected' }} value='1'>{{ 'Yes'|trans }}</option>
              <option {{ App.Config.configArr.local_login == '0' ? ' selected' }} value='0'>{{ 'No'|trans }}</option>
          </select>
          <p class='smallgray'>{{ 'You can still show the local login form by appending ?letmein to the login page URL.'|trans }}</p>

          <div class='mt-4 text-center'>
              <button type='submit' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
          </div>
        </div>
    </form>

    <div class='box'>
      <h3>{{ 'Information'|trans }}</h3>
      <hr>
      <ul class='list-group'>
        <li class='list-group-item'>{{ 'Operating System'|trans }}: {{ phpInfos.0 }}</li>
        <li class='list-group-item'>{{ 'PHP Version'|trans }}: {{ phpInfos.1 }}</li>
        <li class='list-group-item'>{{ 'MySQL Version'|trans }}: {{ phpInfos.6 }}</li>
        <li class='list-group-item'>{{ 'Largest integer supported'|trans }}: {{ phpInfos.2 }}</li>
        <li class='list-group-item'>{{ 'PHP configuration directory'|trans }}: {{ phpInfos.3 }}</li>
        <li class='list-group-item'>{{ 'Maximum file size for uploaded files'|trans }}: {{ phpInfos.4 }}</li>
        {% if phpInfos.5|length > 1 %}
          <li class='list-group-item'>{{ 'Timezone'|trans }}: {{ phpInfos.5 }}</li>
        {% endif %}
      </ul>
  </div>
</div>

<!-- TAB 2 TEAMS -->
<div data-tabcontent='2' hidden>
    <div id='teamsDiv' class='form-group'>
        <!-- CREATE TEAM -->
        <div class='box'>
            <h3>{{ 'Add a New Team'|trans }}</h3>
            <hr>
            <input class='form-control custom-control-inline col-md-4' required type='text' placeholder='Pasteur lab' id='teamsName' />
            <button id='teamsCreateButton' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
        </div>

        <!-- DISPLAY TEAMS -->
        <div class='box'>
          <h3>{{ 'Edit Existing Teams'|trans }}</h3>
          <hr>

          <ul class='list-group'>
            {% for team in teamsArr %}
              <li class='list-group-item'>
                <ul class='list-inline'>
                  <li class='list-inline-item mb-2'>
                    {% set count = Teams.getStats(team.id) %}
                    <label for='teamName_{{ team.id }}'>{{ 'Team Name'|trans }}</label>
                    <input data-id='{{ team.id }}' class='form-control custom-control-inline' id='teamName_{{ team.id }}' type='text' value='{{ team.name }}' />
                  </li>

                  <li class='list-inline-item mb-2'>
                    <label for='teamOrgid_{{ team.id }}'>{{ 'Team Organisation ID'|trans }}</label>
                    <input data-id='{{ team.id }}' class='form-control custom-control-inline' id='teamOrgid_{{ team.id }}' type='text' value='{{ team.orgid }}' />
                  </li>

                  <li class='list-inline-item mb-2'>
                    {% if count.totusers == 0 and team.id != App.Users.userData.team %}
                    <button data-id='{{ team.id }}' id='teamsDestroyButton_{{ team.id }}' class='button btn btn-danger teamsDestroyButton'>
                        {{ 'Delete'|trans }}
                    </button>
                    {% else %}
                    <button data-id='{{ team.id }}' id='teamsArchiveButton_{{ team.id }}' class='button btn btn-neutral teamsArchiveButton'>
                        {{ 'Archive'|trans }}
                    </button>
                  </li>

                  {% endif %}

                  <li class='list-inline-item mb-2'>
                    <label for='teamVisible_{{ team.id }}'>{{ 'Visible on registration page'|trans }}</label>
                    <select class='form-control' name='teamsVisible' id='teamVisible_{{ team.id }}'>
                      <option value='1'{{ team.visible ? " selected='selected'" }}>{{ 'Yes'|trans }}</option>
                      <option value='0'{{ not team.visible ? " selected='selected'" }}>{{ 'No'|trans }}</option>
                    </select>
                  </li>

                  <li class='list-inline-item mb-2'>
                    <button data-id='{{ team.id }}' id='teamsUpdateButton_{{ team.id }}' class='button btn btn-primary teamsUpdateButton'>
                        {{ 'Save'|trans }}
                    </button>
                  </li>

                  <li class='list-inline-item mb-2'>
                    <p class='smallgray'>{{ 'Members'|trans }}: {{ count.totusers }} −
                    {% trans %}
                    Experiment
                    {% plural count.totxp %}
                    Experiments
                    {% endtrans %}
                    : {{ count.totxp }} ({{ count.totxpts }} timestamped) − {{ 'Items'|trans }}: {{ count.totdb }} − {{ 'Created'|trans }}: {{ team.datetime }}<p>
                  </li>
                </ul>
              </li>
            {% endfor %}
        </ul>
      </div>
    </div>
</div>

<!-- TAB 3 USERS -->
<div data-tabcontent='3' hidden>
  {% include 'editusers.html' %}
</div>

<!-- TAB 4 TIMESTAMP -->
<div class='box' data-tabcontent='4' hidden>
  <h3>{{ 'Timestamping Configuration'|trans }}</h3>
  <hr>
  {% include 'ts-config.html' %}

  <h3 class='mt-3'>{{ 'Blockchain timestamp configuration'|trans }}</h3>
  <hr>
  <label for='blox_enabled'>{{ 'Enable blockchain timestamping with Bloxberg:'|trans }}</label>
  <select class='form-control col-md-4' data-trigger='change' data-model='config' data-target='blox_enabled' id='blox_enabled' autocomplete='off'>
    <option value='1' {{ App.Config.configArr.blox_enabled ? ' selected' }}>{{ 'Yes'|trans }}</option>
    <option value='0' {{ not App.Config.configArr.blox_enabled ? 'selected' }}>{{ 'No'|trans }}</option>
  </select>

  <label for='blox_anon'>{{ 'Anonymize author for GDPR compliance:'|trans }}</label>
  <select class='form-control col-md-4' data-trigger='change' data-model='config' data-target='blox_anon' id='blox_anon' autocomplete='off'>
    <option value='1' {{ App.Config.configArr.blox_anon ? ' selected' }}>{{ 'Yes'|trans }}</option>
    <option value='0' {{ not App.Config.configArr.blox_anon ? 'selected' }}>{{ 'No'|trans }}</option>
  </select>
</div>

<!-- TAB 5 SECURITY -->
<div class='box' data-tabcontent='5' hidden>
  <h3>{{ 'Security Settings'|trans }}</h3>
  <hr>
  <form class='form-group' method='post' action='app/controllers/SysconfigController.php'>
    {{ App.Session.get('csrf')|csrf }}
    <input type='hidden' name='updateConfig' value='true' />

    <label for='admin_validate'>{{ 'Users need validation by admin after registration:'|trans }}</label>
    <select class='form-control col-md-4' name='admin_validate' id='admin_validate'>
      <option value='1' {{ App.Config.configArr.admin_validate ? " selected" }}>{{ 'Yes'|trans }}</option>
      <option value='0' {{ not App.Config.configArr.admin_validate ? " selected" }}>{{ 'No'|trans }}</option>
    </select>
    <p class='smallgray'>{{ 'Set to yes for added security.'|trans }}</p>

    <label for='email_domain'>{{ 'Enforce a domain name for emails'|trans }}</label>
    <input id='email_domain' name='email_domain' class='form-control col-md-4' type='text' placeholder='example.edu' value='{{ App.Config.configArr.email_domain }}' />
    <p class='smallgray'>{{ 'Only email addresses at this domain will be allowed to register an account.'|trans }}<br>
    {{ 'You can add several domains by separating them with a comma.'|trans }}</p>

    <label for='login_tries'>{{ 'Number of allowed login attempts:'|trans }}</label>
    <input class='form-control col-md-4' type='number' value='{{ App.Config.configArr.login_tries }}' name='login_tries' id='login_tries' />
    <p class='smallgray'>{{ '3 might be too few. See for yourself :)'|trans }}</p>

    <label for='autologout_time'>{{ 'Time after which inactive sessions are invalidated (force logout) (in seconds):'|trans }}</label>
    <input class='form-control col-md-4' type='number' value='{{ App.Config.configArr.autologout_time }}' name='autologout_time' id='autologout_time' />
    <p class='smallgray'>
      {{ 'Set to 0 to disable this feature.'|trans }}
    </p>
    <div class='mt-4 text-center'>
      <button type='submit' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
    </div>
  </form>

  <hr>
  <div id='bruteforceDiv'>
    <h3>{{ 'Bruteforce login protection' }}</h3>
    <div class='mb-1'>
      <span>{{ '%d users are currently prevented from logging in from unknown devices.'|trans|format(nologinUsersCount) }}</span>
      <button type='submit' data-action='clear-nologinusers' {{ nologinUsersCount == 0 ? 'disabled' }} class='button btn btn-primary'>{{ 'Clear'|trans }}</button>

    </div>

    <div>
      <span>{{ '%d devices are currently denied authentication.'|trans|format(lockoutDevicesCount) }}</span>
      <button type='submit' data-action='clear-lockoutdevices' {{ lockoutDevicesCount == 0 ? 'disabled' }} class='button btn btn-primary'>{{ 'Clear'|trans }}</button>
    </div>
  </div>
</div>


<!-- TAB 6 EMAIL -->
<div data-tabcontent='6' hidden>
  <div class='box'>
    <h3>{{ 'E-mail Settings'|trans }}</h3>
    <hr>
    <form class='form-group' method='post' action='app/controllers/SysconfigController.php'>
      {{ App.Session.get('csrf')|csrf }}
      <input type='hidden' name='updateConfig' value='true' />
      <p>{{ "Without a valid way to send emails, users won't be able to reset their password. It is recommended to create a specific %ssmtp2go.com%s account and add the information here."|trans|format("<a href='https://www.smtp2go.com/?s=eLabFTW'>", "</a>")|raw }}</p>

        <label for='mail_from'>{{ 'Sender address:'|trans }}</label>
        <input class='form-control col-md-4' type='text' value='{{ App.Config.configArr.mail_from }}' name='mail_from' id='mail_from' />

        <label for='smtp_address'>{{ 'Address of the SMTP server:'|trans }}</label>
        <input class='form-control col-md-4' type='text' value='{{ App.Config.configArr.smtp_address }}' placeholder='mail.smtp2go.com' name='smtp_address' id='smtp_address' />

        <label for='smtp_port'>{{ 'SMTP Port:'|trans }}</label>
        <input class='form-control col-md-4' type='text' placeholder='587' value='{{ App.Config.configArr.smtp_port }}' name='smtp_port' id='smtp_port' />
        <span class='smallgray'>{{ 'Default is 587.'|trans }}</span>

        <label for='smtp_username'>{{ 'SMTP username:'|trans }}</label>
        <input class='form-control col-md-4' type='text' value='{{ App.Config.configArr.smtp_username }}' name='smtp_username' id='smtp_username' />
        <label for='smtp_password'>{{ 'SMTP password'|trans }}</label>
        {% if App.Config.configArr.smtp_password|length == 0 %}
          <input class='form-control col-md-4' type='password' name='smtp_password' id='smtp_password' autocomplete='off' />
        {% else %}
          <p>
            {{ 'A password is already set.'|trans }}
            {{ '%sClear it%s or change it below:'|trans|format("
                <a href='app/controllers/SysconfigController.php?clearSmtppass=1'>",
                "</a>"
            )|raw }}
            <span data-action='toggle-next' class='button btn btn-primary mt-2'>{{ 'Edit'|trans }}</span>
            <input class='form-control col-md-4' type='password' name='smtp_password' hidden autocomplete='off' id='hidden_smtp_password' />
          </p>
        {% endif %}

      <div class='mt-4 text-center'>
        <button type='submit' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
      </div>
    </form>
  </div>

  <!-- TEST EMAIL -->
  <div class='box form-group'>
    <label for='testemailEmail'>{{ 'Send a test email'|trans }}</label>
    <input class='form-control col-md-4' type='email' value='{{ App.Users.userData.email }}' id='testemailEmail' />
    <div class='mt-4 text-center'>
      <button id='testemailButton' class='button btn btn-primary'>{{ 'Send'|trans }}</button>
    </div>
  </div>

  <!-- MASS EMAIL -->
  <div class='box form-group'>
    <h3>{{ 'Send a Mass Email'|trans }}</h3>
    <hr>
    <label for='massSubject'>{{ 'Email Subject'|trans }}</label>
    <input class='form-control col-md-4' type='text' id='massSubject' size='45' />

    <label for='massBody'>{{ 'Email Body'|trans }}</label>
    <textarea class='form-control col-md-4' id='massBody'></textarea>
    <div class='mt-4 text-center'>
      <button id='massSend' class='button btn btn-primary'>{{ 'Send'|trans }}</button>
    </div>
  </div>

</div>

<!-- TAB 7 SAML -->
<div data-tabcontent='7' hidden>
    {{ 'Note: the documentation about SAML is available %shere%s.'|format("<a href='https://doc.elabftw.net/saml.html'>", "</a>")|msg('ok', false) }}
    {{ 'Note: an XML file with the configuration is available %shere%s.'|format("<a href='metadata.php'>", "</a>")|msg('ok', false) }}
    <div class='box'>
        <form method='post' action='app/controllers/SysconfigController.php'>
            {{ App.Session.get('csrf')|csrf }}
            <h3>Service provider (this instance of eLabFTW)</h3>
            <div class='form-group'>
              <input type='hidden' name='updateConfig' value='true' />
              <label for='saml-toggle'>Toggle SAML login:</label>
              <select class='form-control col-md-6' id='saml-toggle' name='saml_toggle'>
                <option value='1'{{ App.Config.configArr.saml_toggle == '1' ? ' selected' }}>Enabled</option>
                <option value='0'{{ App.Config.configArr.saml_toggle == '0' ? ' selected' }}>Disabled</option>
              </select>

              <label for='saml-debug'>Debug mode:</label>
              <select class='form-control col-md-6' id='saml-debug' name='saml_debug'>
                <option value='1'{{ App.Config.configArr.saml_debug == '1' ? ' selected' }}>Yes</option>
                <option value='0'{{ App.Config.configArr.saml_debug == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-strict'>Strict mode:</label>
              <select class='form-control col-md-6' id='saml-strict' name='saml_strict'>
                <option value='1'{{ App.Config.configArr.saml_strict == '1' ? ' selected' }}>Yes</option>
                <option value='0'{{ App.Config.configArr.saml_strict == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-sync-teams'>Synchronize the local teams with the teams sent by IDP:</label>
              <select class='form-control col-md-6' id='saml-sync-teams' name='saml_sync_teams'>
                <option value='1'{{ App.Config.configArr.saml_sync_teams == '1' ? ' selected' }}>Enabled</option>
                <option value='0'{{ App.Config.configArr.saml_sync_teams == '0' ? ' selected' }}>Disabled</option>
              </select>

              <label for='saml-base'>Base url:</label>
              <input class='form-control col-md-6' type='url' id='saml-base' name='saml_baseurl' placeholder='https://elabftw.example.org' value='{{ App.Config.configArr.saml_baseurl }}' />

              <label for='saml-entityid'>EntityId:</label>
              <input class='form-control col-md-6' type='url' id='saml-entityid' name='saml_entityid' placeholder='https://elabftw.example.org' value='{{ App.Config.configArr.saml_entityid }}' />

              <label for='saml-acs-binding'>Assertion Consumer Service binding (only POST supported)</label>
              <select class='form-control col-md-6' id='saml-acs-binding' name='saml_acs_binding'>
                <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect' {{ App.Config.configArr.saml_acs_binding == 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect' ? 'selected' }}>Redirect</option>
                <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST' {{ App.Config.configArr.saml_acs_binding == 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST' ? 'selected' }}>POST</option>
              </select>

              <label for='saml-slo-binding'>Single Logout Service binding (only Redirect supported).</label>
              <select class='form-control col-md-6' id='saml-slo-binding' name='saml_slo_binding'>
                <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect' {{ App.Config.configArr.saml_slo_binding == 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect' ? 'selected' }}>Redirect</option>
                <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST' {{ App.Config.configArr.saml_slo_binding == 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST' ? 'selected' }}>POST</option>
              </select>

              <label for='saml-nameidformat'>NameIDFormat. Default is "urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress".</label>
              <input class='form-control col-md-6' type='text' id='saml-nameidformat' name='saml_nameidformat' placeholder='urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress' value='{{ App.Config.configArr.saml_nameidformat }}' />

              <label for='x509'>x509 Certificate in PEM format</label>
              <textarea class='form-control col-md-6' id='x509' name='saml_x509'>{{ App.Config.configArr.saml_x509 }}</textarea>

              <label for='saml_privatekey'>x509 Certificate private key</label>
              <textarea class='form-control col-md-6' id='saml_privatekey' name='saml_privatekey'>{{ App.Config.configArr.saml_privatekey }}</textarea>

              <label for='x509_new'>Rollover x509 Certificate in PEM format (only published in metadata, not used)</label>
              <textarea class='form-control col-md-6' id='x509_new' name='saml_x509_new'>{{ App.Config.configArr.saml_x509_new }}</textarea>

              <label for='saml-team-create'>Create team sent by IDP if it doesn't exist already:</label>
              <select class='form-control col-md-6' id='saml-team-create' name='saml_team_create'>
                  <option value='1'{{ App.Config.configArr.saml_team_create == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_team_create == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-team-default'>If no team attribute is found, to which team user is assigned?</label>
              <select class='form-control col-md-6' name='saml_team_default' id='saml-team-default'>
                {% for team in teamsArr %}
                  <option {{ team.id == App.Config.configArr.saml_team_default ? 'selected' }} value='{{ team.id }}'>{{ team.name }}</option>
                {% endfor %}
                <option {{ 0 == App.Config.configArr.saml_team_default ? 'selected' }} value='0'>Throw error!</option>
                <option {{ '-1' == App.Config.configArr.saml_team_default ? 'selected' }} value='-1'>Let user select a team</option>
              </select>

              <label for='saml-user-default'>If the user doesn't exist yet, what to do?</label>
              <select class='form-control col-md-6' name='saml_user_default' id='saml-user-default'>
                <option {{ 1 == App.Config.configArr.saml_user_default ? 'selected' }} value='1'>Create the user on the fly</option>
                <option {{ 0 == App.Config.configArr.saml_user_default ? 'selected' }} value='0'>Throw error, allowing a sysadmin to create the user</option>
              </select>


              <h4 class='mt-2'>Security settings</h4>
              <label for='saml-nameidencrypted'>Encrypt the nameID of the samlp:logoutRequest sent by this SP (nameIdEncrypted)</label>
              <select class='form-control col-md-6' id='saml-nameidencrypted' name='saml_nameidencrypted'>
                  <option value='1'{{ App.Config.configArr.saml_nameidencrypted == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_nameidencrypted == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-authnrequestssigned'>Sign the samlp:AuthnRequest messages sent (authnRequestsSigned)</label>
              <select class='form-control col-md-6' id='saml-authnrequestssigned' name='saml_authnrequestssigned'>
                  <option value='1'{{ App.Config.configArr.saml_authnrequestssigned == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_authnrequestssigned == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-logoutrequestsigned'>Sign the samlp:logoutRequest messages sent (logoutRequestSigned)</label>
              <select class='form-control col-md-6' id='saml-logoutrequestsigned' name='saml_logoutrequestsigned'>
                  <option value='1'{{ App.Config.configArr.saml_logoutrequestsigned == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_logoutrequestsigned == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-logoutresponsesigned'>Sign the samlp:logoutResponse messages sent (logoutresponsesigned)</label>
              <select class='form-control col-md-6' id='saml-logoutresponsesigned' name='saml_logoutresponsesigned'>
                  <option value='1'{{ App.Config.configArr.saml_logoutresponsesigned == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_logoutresponsesigned == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-signmetadata'>Sign the metadata (signMetadata)</label>
              <select class='form-control col-md-6' id='saml-signmetadata' name='saml_signmetadata'>
                  <option value='1'{{ App.Config.configArr.saml_signmetadata == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_signmetadata == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-wantmessagessigned'>Require the samlp:Response to be signed (wantMessagesSigned)</label>
              <select class='form-control col-md-6' id='saml-wantmessagessigned' name='saml_wantmessagessigned'>
                  <option value='1'{{ App.Config.configArr.saml_wantmessagessigned == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_wantmessagessigned == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-wantassertionsencrypted'>Require the saml:Assertion to be encrypted (wantAssertionsEncrypted)</label>
              <select class='form-control col-md-6' id='saml-wantassertionsencrypted' name='saml_wantassertionsencrypted'>
                  <option value='1'{{ App.Config.configArr.saml_wantassertionsencrypted == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_wantassertionsencrypted == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-wantassertionssigned'>Require the saml:Assertion to be signed (wantAssertionsSigned)</label>
              <select class='form-control col-md-6' id='saml-wantassertionssigned' name='saml_wantassertionssigned'>
                  <option value='1'{{ App.Config.configArr.saml_wantassertionssigned == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_wantassertionssigned == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-wantnameid'>Require the NameID element on the SAMLResponse received (wantNameId)</label>
              <select class='form-control col-md-6' id='saml-wantnameid' name='saml_wantnameid'>
                  <option value='1'{{ App.Config.configArr.saml_wantnameid == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_wantnameid == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-wantnameidencrypted'>Require the NameID element received to be encrypted (wantNameIdEncrypted)</label>
              <select class='form-control col-md-6' id='saml-wantnameidencrypted' name='saml_wantnameidencrypted'>
                  <option value='1'{{ App.Config.configArr.saml_wantnameidencrypted == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_wantnameidencrypted == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-wantxmlvalidation'>Validate all received xmls (strict mode must be activated) (wantXMLValidation)</label>
              <select class='form-control col-md-6' id='saml-wantxmlvalidation' name='saml_wantxmlvalidation'>
                  <option value='1'{{ App.Config.configArr.saml_wantxmlvalidation == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_wantxmlvalidation == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-relaxdestinationvalidation'>SAMLResponse with an empty value as its Destination will not be rejected for this fact. (relaxDestinationValidation)</label>
              <select class='form-control col-md-6' id='saml-relaxdestinationvalidation' name='saml_relaxdestinationvalidation'>
                  <option value='1'{{ App.Config.configArr.saml_relaxdestinationvalidation == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_relaxdestinationvalidation == '0' ? ' selected' }}>No</option>
              </select>

              <label for='saml-lowercaseurlencoding'>ADFS compatibility on signature verification (lowercaseUrlEncoding)</label>
              <select class='form-control col-md-6' id='saml-lowercaseurlencoding' name='saml_lowercaseurlencoding'>
                  <option value='1'{{ App.Config.configArr.saml_lowercaseurlencoding == '1' ? ' selected' }}>Yes</option>
                  <option value='0'{{ App.Config.configArr.saml_lowercaseurlencoding == '0' ? ' selected' }}>No</option>
              </select>

              <div class='mt-4 text-center'>
                  <button type="submit" name="Submit" class='button btn btn-primary'>{{ 'Save'|trans }}</button>
              </div>

            </div>
        </form>
    </div>

    <div class='box'>
        <h3>Identity Providers Configuration</h3>

        {% if idpsArr|length > 0 %}
            <h4>Existing Identity Providers</h4>
            {% for idp in idpsArr %}
              <div class='box'>
                  <a class='clickable idpsDestroy float-right' title='{{ 'Delete'|trans }}' data-id='{{ idp.id }}'>
                      <i class='fas fa-trash-alt fa-2x'></i>
                  </a>
                  <h4>{{ idp.name|upper }} ({{ idp.entityid }})</h4>
                  <form method='post' action='app/controllers/IdpsController.php'>
                    {{ App.Session.get('csrf')|csrf }}
                    <div class='form-group'>
                      <input type='hidden' name='idpsUpdate' />
                      <input type='hidden' name='id' value='{{ idp.id }}' />

                      <label for='editIdpName_{{ idp.id }}'>Friendly name:</label>
                      <input class='form-control col-md-6' type='text' id='editIdpName_{{ idp.id }}' name='name' value='{{ idp.name }}' />
                      <label for='entityId_{{ idp.id }}'>EntityId:</label>
                      <input class='form-control col-md-6' type='url' id='entityId_{{ idp.id }}' name='entityid' value='{{ idp.entityid }}' />
                      <label for='ssoUrl_{{ idp.id }}'>Single Sign-On URL:</label>
                      <input class='form-control col-md-6' type='url' id='ssoUrl_{{ idp.id }}' name='ssoUrl' value='{{ idp.sso_url }}' />
                      <label for='ssoBinding_{{ idp.id }}'>Single Sign-On binding (only Redirect is supported):</label>
                      <select class='form-control col-md-6' id='ssoBinding_{{ idp.id }}' name='ssoBinding'>
                        <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect' {{ idp.sso_binding == 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect' ? 'selected' }}>Redirect</option>
                        <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST' {{ idp.sso_binding == 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST' ? 'selected' }}>POST</option>
                      </select>
                      <label for='sloUrl_{{ idp.id }}'>Single Log Out URL:</label>
                      <input class='form-control col-md-6' type='url' id='sloUrl_{{ idp.id }}' name='sloUrl' value='{{ idp.slo_url }}' />
                      <label for='sloBinding_{{ idp.id }}'>Single Log Out binding (only Redirect is supported):</label>
                      <select class='form-control col-md-6' id='sloBinding_{{ idp.id }}' name='sloBinding'>
                        <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect' {{ idp.slo_binding == 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect' ? 'selected' }}>Redirect</option>
                        <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST' {{ idp.slo_binding == 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST' ? 'selected' }}>POST</option>
                      </select>

                      <label for='x509_{{ idp.id }}'>x509cert:</label>
                      <textarea class='form-control col-md-6' name='x509' id='x509_{{ idp.id }}'>{{ idp.x509 }}</textarea>

                      <label for='x509_new_{{ idp.id }}'>x509cert (additional for rollover):</label>
                      <textarea class='form-control col-md-6' name='x509_new' id='x509_new_{{ idp.id }}'>{{ idp.x509_new }}</textarea>

                      <label for='saml-email_{{ idp.id }}'>What attribute to look for the email:</label>
                      <input class='form-control col-md-6' type='text' id='saml-email_{{ idp.id }}' name='email_attr' value='{{ idp.email_attr }}' />

                      <label for='saml-team_{{ idp.id }}'>What attribute to look for the team name:</label>
                      <input class='form-control col-md-6' type='text' id='saml-team_{{ idp.id }}' name='team_attr' value='{{ idp.team_attr }}' />

                      <label for='saml-firstname_{{ idp.id }}'>What attribute to look for the firstname:</label>
                      <input class='form-control col-md-6' type='text' id='saml-firstname_{{ idp.id }}' name='fname_attr' value='{{ idp.fname_attr }}' />

                      <label for='saml-lastname_{{ idp.id }}'>What attribute to look for the lastname:</label>
                      <input class='form-control col-md-6' type='text' id='saml-lastname_{{ idp.id }}' name='lname_attr' value='{{ idp.lname_attr }}' />

                      <label for='active_{{ idp.id }}'>Active</label>
                      <select class='form-control col-md-6 col-md-4' autocomplete='off' id='active_{{ idp.id }}' name='active'>
                          <option value='1' {{ idp.active ? " selected='selected'" }}>{{ 'Yes'|trans }}</option>
                          <option value='0' {{ not idp.active ? " selected='selected'" }}>{{ 'No'|trans }}</option>
                      </select>
                      <div class='mt-4 text-center'>
                          <button type='submit' name='Submit' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
                      </div>
                    </div>
                  </form>
                </div>
            {% endfor %}
        {% endif %}

        <div class='box'>
            <h4>Add new Identity Provider</h4>
            <form method='post' action='app/controllers/IdpsController.php'>
              {{ App.Session.get('csrf')|csrf }}
              <div class='form-group'>
                <input type='hidden' name='idpsCreate' />

                <label for='name'>Friendly Name:</label>
                <input class='form-control col-md-6' type='text' id='name' name='name' required />

                <label for='entityid'>EntityId:</label>
                <input class='form-control col-md-6' type='url' id='entityid' name='entityid' required />

                <label for='ssoUrl'>Single Sign-On URL:</label>
                <input class='form-control col-md-6' type='url' id='ssoUrl' name='ssoUrl' required />

                <label for='ssoBinding'>Single Sign-On Binding (only Redirect is supported):</label>
                <select class='form-control col-md-6' id='ssoBinding' name='ssoBinding'>
                  <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect'>Redirect</option>
                  <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST'>POST</option>
                </select>

                <label for='sloUrl'>Single Log Out URL:</label>
                <input class='form-control col-md-6' type='url' id='sloUrl' name='sloUrl' />

                <label for='sloBinding'>Single Log Out Binding (only Redirect is supported):</label>
                <select class='form-control col-md-6' id='sloBinding' name='sloBinding'>
                  <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect'>Redirect</option>
                  <option value='urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST'>POST</option>
                </select>

                <label for='x509_idp'>x509 Certificate:</label>
                <textarea class='form-control col-md-6' id='x509_idp' name='x509' required></textarea>

                <label for='x509_new_idp'>x509 Certificate (additional for rollover):</label>
                <textarea class='form-control col-md-6' id='x509_new_idp' name='x509_new' required></textarea>

                <label for='newidp-email_attr'>What attribute to look for the email:</label>
                <input class='form-control col-md-6' type='text' id='newidp-email_attr' name='email_attr' />

                <label for='newidp-team_attr'>What attribute to look for the team name:</label>
                <input class='form-control col-md-6' type='text' id='newidp-team_attr' name='team_attr' />

                <label for='newidp-fname_attr'>What attribute to look for the firstname:</label>
                <input class='form-control col-md-6' type='text' id='newidp-fname_attr' name='fname_attr' />

                <label for='newidp-lname_attr'>What attribute to look for the lastname:</label>
                <input class='form-control col-md-6' type='text' id='newidp-lname_attr' name='lname_attr' />

                <label for='active'>Active</label>
                <select class='form-control col-md-6' id='active' autocomplete='off' name='active'>
                    <option value='1' selected='selected'>{{ 'Yes'|trans }}</option>
                    <option value='0'>{{ 'No'|trans }}</option>
                </select>

                <div class='mt-4 text-center'>
                  <button type='submit' name='Submit' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
                </div>
              </div>
            </form>
        </div>

    </div>
</div>

<!-- TAB 8 PRIVACY POLICY -->
<div class='box' data-tabcontent='8' hidden>
  <h3>{{ 'Adjust your privacy policy notice'|trans }}</h3>
  <hr>
  {% if App.Config.configArr.privacy_policy is null %}
    {{ 'Note: the text below is a template and must be edited and saved.'|trans|msg('ok', false) }}
  {% endif %}

  <form method='post' action='app/controllers/SysconfigController.php'>
    {{ App.Session.get('csrf')|csrf }}
    <textarea name='privacy_policy' class='mceditable'>
      {{ App.Config.configArr.privacy_policy|default(privacyPolicyTemplate)|raw }}
    </textarea>
    <div class='mt-4 text-center'>
      <button type='submit' name='Submit' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
      <button class='button btn btn-danger' type='submit' name='clear_policy'>{{ 'Clear'|trans }}</button>
    </div>
  </form>
</div>

<!-- TAB 9 EXTERNAL AUTH -->
<div class='box' data-tabcontent='9' hidden>
    <form method='post' action='app/controllers/SysconfigController.php'>
      {{ App.Session.get('csrf')|csrf }}
      <div class='form-group'>
        <h3>{{ 'External authentication mapping'|trans }}</h3>
        <hr>
        <input type='hidden' name='updateConfig' value='true' />

          <p class='smallgray'>{{ 'If the server manages authentication, then you can provide here the environment variables names for user information.'|trans }}</p>

        <label for='extauth_remote_user'>{{ 'Remote user'|trans }}</label>
        <input class='form-control col-md-4' type='text' placeholder='REMOTE_USER' value='{{ App.Config.configArr.extauth_remote_user }}' name='extauth_remote_user' id='extauth_remote_user' />

        <label for='extauth_firstname'>{{ 'Firstname'|trans }}</label>
        <input class='form-control col-md-4' type='text' placeholder='MELLON_givenName' value='{{ App.Config.configArr.extauth_firstname }}' name='extauth_firstname' id='extauth_firstname' />

        <label for='extauth_lastname'>{{ 'Lastname'|trans }}</label>
        <input class='form-control col-md-4' type='text' placeholder='MELLON_sn' value='{{ App.Config.configArr.extauth_lastname }}' name='extauth_lastname' id='extauth_lastname' />

        <label for='extauth_email'>{{ 'Email'|trans }}</label>
        <input class='form-control col-md-4' type='text' placeholder='MELLON_mail' value='{{ App.Config.configArr.extauth_email }}' name='extauth_email' id='extauth_email' />

        <label for='extauth_teams'>{{ 'Teams'|trans }}</label>
        <input class='form-control col-md-4' type='text' placeholder='MELLON_ou' value='{{ App.Config.configArr.extauth_teams }}' name='extauth_teams' id='extauth_teams' />

        <label for='logout_url'>{{ 'Logout URL'|trans }}</label>
        <input class='form-control col-md-4' type='text' placeholder='https://idp.example.edu/saml/logout' value='{{ App.Config.configArr.logout_url }}' name='logout_url' id='logout_url' />

        <label for='extauth-team-default'>If no team attribute is found, to which team user is assigned?</label>
        <select class='form-control col-md-4' name='saml_team_default' id='extauth-team-default'>
          {% for team in teamsArr %}
            <option {{ team.id == App.Config.configArr.saml_team_default ? 'selected' }} value='{{ team.id }}'>{{ team.name }}</option>
          {% endfor %}
          <option {{ 0 == App.Config.configArr.saml_team_default ? 'selected' }} value='0'>Throw error!</option>
        </select>

        <label for='extauth-user-default'>If the user doesn't exist yet, what to do?</label>
        <select class='form-control col-md-4' name='saml_user_default' id='extauth-user-default'>
          <option {{ 1 == App.Config.configArr.saml_user_default ? 'selected' }} value='1'>Create the user on the fly</option>
          <option {{ 0 == App.Config.configArr.saml_user_default ? 'selected' }} value='0'>Throw error, allowing a sysadmin to create the user</option>
        </select>


        <label for='extauth-team-create'>Create team sent by server if it doesn't exist already:</label>
        <select class='form-control col-md-4' id='extauth-team-create' name='saml_team_create'>
            <option value='1'{{ App.Config.configArr.saml_team_create == '1' ? ' selected' }}>Yes</option>
            <option value='0'{{ App.Config.configArr.saml_team_create == '0' ? ' selected' }}>No</option>
        </select>


        <div class='mt-4 text-center'>
          <button type='submit' name='Submit' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
        </div>
      </div>
    </form>
</div>

<!-- TAB 10 LDAP -->
<div class='box' data-tabcontent='10' hidden>
    <form method='post' action='app/controllers/SysconfigController.php'>
      {{ App.Session.get('csrf')|csrf }}
      <div class='form-group'>
        <h3>{{ 'LDAP configuration'|trans }}</h3>
        <hr>
        <input type='hidden' name='updateConfig' value='true' />

        <p class='smallgray'>{{ 'This page allows you to configure LDAP authentication.'|trans }}</p>

        <label for='ldap_toggle'>{{ 'Toggle LDAP login'|trans }}</label>
        <select class='form-control col-md-4' id='ldap_toggle' name='ldap_toggle'>
          <option value='1'{{ App.Config.configArr.ldap_toggle == '1' ? ' selected' }}>Enabled</option>
          <option value='0'{{ App.Config.configArr.ldap_toggle == '0' ? ' selected' }}>Disabled</option>
        </select>

        <label for='ldap_host'>{{ 'LDAP Host'|trans }}</label>
        <input class='form-control col-md-4' type='text' placeholder='ldap' value='{{ App.Config.configArr.ldap_host }}' name='ldap_host' id='ldap_host' />
        <p class='smallgray'>{{ 'Domain name or IP address'|trans }}</p>

        <label for='ldap_port'>{{ 'LDAP Port'|trans }}</label>
        <input class='form-control col-md-4' type='text' placeholder='389' value='{{ App.Config.configArr.ldap_port }}' name='ldap_port' id='ldap_port' />
        <p class='smallgray'>{{ 'Default: 389 LDAPS: 636'|trans }}</p>

        <label for='ldap_base_dn'>LDAP Base DN</label>
        <input class='form-control col-md-4' type='text' placeholder='dc=example,dc=com' value='{{ App.Config.configArr.ldap_base_dn }}' name='ldap_base_dn' id='ldap_base_dn' />

        <label for='ldap_username'>LDAP {{ 'Username'|trans }} (keep empty to use anonymous bind)</label>
        <input class='form-control col-md-4' type='text' autocomplete='off' placeholder='cn=admin,dc=example,dc=com' value='{{ App.Config.configArr.ldap_username}}' name='ldap_username' id='ldap_username' />

        <label for='ldap_password'>LDAP {{ 'Password'|trans }}</label>
        {% if App.Config.configArr.ldap_password|length == 0 %}
          <input class='form-control col-md-4' type='password' name='ldap_password' id='ldap_password' autocomplete='off' />
        {% else %}
          <p>
            {{ 'A password is already set.'|trans }}
            {{ '%sClear it%s or change it below:'|trans|format("
                <a href='app/controllers/SysconfigController.php?clearLdappass=1'>",
                "</a>"
            )|raw }}
            <span data-action='toggle-next' class='button btn btn-primary mt-2'>{{ 'Edit'|trans }}</span>
            <input class='form-control col-md-4' type='password' name='ldap_password' hidden autocomplete='off' id='hidden_ldap_password' />
          </p>
        {% endif %}

        <label for='ldap_use_tls'>{{ 'Use TLS'|trans }}</label>
        <select class='form-control col-md-4' id='ldap_use_tls' name='ldap_use_tls'>
          <option value='1'{{ App.Config.configArr.ldap_use_tls == '1' ? ' selected' }}>{{ 'Yes'|trans }}</option>
          <option value='0'{{ App.Config.configArr.ldap_use_tls == '0' ? ' selected' }}>{{ 'No'|trans }}</option>
        </select>

        <label for='ldap-team'>What attribute to look for the team name:</label>
        <input class='form-control col-md-4' type='text' id='ldap-team' name='ldap_team' value='{{ App.Config.configArr.ldap_team }}' />

        <label for='ldap-team-create'>Create team sent by server if it doesn't exist already:</label>
        <select class='form-control col-md-4' id='ldap-team-create' name='saml_team_create'>
            <option value='1'{{ App.Config.configArr.saml_team_create == '1' ? ' selected' }}>Yes</option>
            <option value='0'{{ App.Config.configArr.saml_team_create == '0' ? ' selected' }}>No</option>
        </select>

        <label for='ldap-team-default'>If no team attribute is found, to which team user is assigned?</label>
        <select class='form-control col-md-4' name='saml_team_default' id='ldap-team-default'>
          {% for team in teamsArr %}
            <option {{ team.id == App.Config.configArr.saml_team_default ? 'selected' }} value='{{ team.id }}'>{{ team.name }}</option>
          {% endfor %}
          <option {{ 0 == App.Config.configArr.saml_team_default ? 'selected' }} value='0'>Throw error!</option>
        </select>

        <label for='ldap-user-default'>If the user doesn't exist yet, what to do?</label>
        <select class='form-control col-md-4' name='saml_user_default' id='ldap-user-default'>
          <option {{ 1 == App.Config.configArr.saml_user_default ? 'selected' }} value='1'>Create the user on the fly</option>
          <option {{ 0 == App.Config.configArr.saml_user_default ? 'selected' }} value='0'>Throw error, allowing a sysadmin to create the user</option>
        </select>

        <label for='ldap-email'>What attribute to look for the email:</label>
        <input class='form-control col-md-4' type='text' id='ldap-email' placeholder='mail' name='ldap_email' value='{{ App.Config.configArr.ldap_email }}' />

        <label for='ldap-firstname'>What attribute to look for the firstname:</label>
        <input class='form-control col-md-4' type='text' id='ldap-firstname' placeholder='givenname' name='ldap_firstname' value='{{ App.Config.configArr.ldap_firstname }}' />

        <label for='ldap-lastname'>What attribute to look for the lastname:</label>
        <input class='form-control col-md-4' type='text' id='ldap-lastname' placeholder='sn' name='ldap_lastname' value='{{ App.Config.configArr.ldap_lastname }}' />

        <div class='mt-4 text-center'>
          <button type='submit' name='Submit' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
        </div>
      </div>
    </form>
</div>

<!-- TAB 11 Uploads -->
<div data-tabcontent='11' hidden>
  <div class='box'>
    <form method='post' action='app/controllers/SysconfigController.php'>
      <input type='hidden' name='updateConfig' value='true' />
      {{ App.Session.get('csrf')|csrf }}
      <label for='uploads_storage'>{{ 'Where user uploaded files are stored:'|trans }}</label>
      <select id='uploads_storage' name='uploads_storage' class='form-control col-md-4'>
          <option {{ App.Config.configArr.uploads_storage == '1' ? ' selected' }} value='1'>{{ 'Local filesystem'|trans }}</option>
          <option {{ App.Config.configArr.uploads_storage == '2' ? ' selected' }} value='2'>{{ 'S3 bucket'|trans }}</option>
      </select>
      <p class='smallgray'>{{ 'You can select where uploaded files will be stored. The default is local storage but you can configure any S3 compatible object storage.'|trans }}</p>

      <label for='s3_bucket_name'>S3 bucket name</label>
      <input class='form-control col-md-4' type='text' id='s3_bucket_name' placeholder='some-bucket-name' name='s3_bucket_name' value='{{ App.Config.configArr.s3_bucket_name }}' />

      <label for='s3_region'>S3 region</label>
      <input class='form-control col-md-4' type='text' id='s3_region' placeholder='uploads' name='s3_region' value='{{ App.Config.configArr.s3_region }}' />

      <label for='s3_region'>S3 endpoint</label>
      <input class='form-control col-md-4' type='url' id='s3_endpoint' placeholder='uploads' name='s3_endpoint' value='{{ App.Config.configArr.s3_endpoint }}' />

      <label for='s3_path_prefix'>S3 path prefix (optional)</label>
      <input class='form-control col-md-4' type='text' id='s3_path_prefix' placeholder='uploads' name='s3_path_prefix' value='{{ App.Config.configArr.s3_path_prefix }}' />


      <div class='mt-4 text-center'>
        <button type='submit' name='Submit' class='button btn btn-primary'>{{ 'Save'|trans }}</button>
      </div>
    </form>
  </div>
</div>

<div id='info' data-page='sysconfig'></div>
{% endblock body %}
